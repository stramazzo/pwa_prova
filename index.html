<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no">
    <meta name="description" content="Multi Calculator PWA - Cinque calcolatori specializzati">
    <meta name="theme-color" content="#2c3e50">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Multi Calculator">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="msapplication-tap-highlight" content="no">
    
    <!-- iOS Icons -->
    <link rel="apple-touch-icon" href="apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="152x152" href="apple-touch-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon-180x180.png">
    <link rel="apple-touch-icon" sizes="167x167" href="apple-touch-icon-167x167.png">
    
    <title>Multi Calculator PWA</title>
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            min-height: 100dvh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
        }

        .container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            padding: 20px;
            max-width: 800px;
            width: 100%;
            margin: auto;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            color: #2c3e50;
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .header p {
            color: #7f8c8d;
            font-size: 1.1rem;
        }

        .menu-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .menu-item {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            padding: 25px;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .menu-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }

        .menu-item h3 {
            font-size: 1.5rem;
            margin-bottom: 10px;
        }

        .menu-item p {
            opacity: 0.9;
            font-size: 0.9rem;
        }

        .calculator {
            display: none;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            padding: 20px;
            max-width: 600px;
            width: 100%;
            margin: auto;
        }

        .calculator.active {
            display: block;
        }

        .calculator-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #ecf0f1;
        }

        .calculator-title {
            font-size: 1.8rem;
            color: #2c3e50;
            font-weight: bold;
        }

        .back-btn {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .back-btn:hover {
            background: #c0392b;
            transform: translateY(-2px);
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            color: #2c3e50;
            font-weight: bold;
            font-size: 0.9rem;
        }

        .input-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ecf0f1;
            border-radius: 10px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .input-group input:focus {
            outline: none;
            border-color: #3498db;
        }

        .result {
            background: #2c3e50;
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            text-align: center;
            font-size: 1.2rem;
            font-weight: bold;
        }

        .results-section {
            margin-top: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 15px;
            border: 2px solid #e9ecef;
        }

        .results-section h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            text-align: center;
            font-size: 1.3rem;
        }

        .result-group {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #dee2e6;
        }

        .result-group:last-child {
            border-bottom: none;
        }

        .result-group label {
            font-weight: bold;
            color: #495057;
            flex: 1;
            margin-right: 15px;
        }

        .result-value {
            background: #2c3e50;
            color: white;
            padding: 8px 12px;
            border-radius: 8px;
            font-weight: bold;
            min-width: 80px;
            text-align: center;
        }

        .action-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .action-btn {
            background: #27ae60;
            color: white;
            border: none;
            padding: 12px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .action-btn.reset {
            background: #e74c3c;
        }

        .action-btn.save {
            background: #f39c12;
        }

        .action-btn.load {
            background: #9b59b6;
        }

        .calculate-btn {
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: bold;
            width: 100%;
            transition: all 0.3s ease;
        }

        .calculate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .simple-calculator {
            display: none;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            padding: 20px;
            max-width: 350px;
            width: 100%;
            margin: auto;
        }

        .simple-calculator.active {
            display: block;
        }

        .display {
            background: #2c3e50;
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            text-align: right;
            min-height: 80px;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
        }

        .previous-operand {
            font-size: 1.2rem;
            color: #bdc3c7;
            margin-bottom: 5px;
            min-height: 1.5rem;
        }

        .current-operand {
            font-size: 2.5rem;
            font-weight: bold;
            word-wrap: break-word;
            word-break: break-all;
        }

        .buttons {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
        }

        .btn {
            background: #ecf0f1;
            border: none;
            border-radius: 15px;
            padding: 20px;
            font-size: 1.5rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #2c3e50;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -khtml-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            touch-action: manipulation;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn.operator {
            background: #3498db;
            color: white;
        }

        .btn.equals {
            background: #27ae60;
            color: white;
        }

        .btn.clear {
            background: #e74c3c;
            color: white;
        }

        .btn.delete {
            background: #f39c12;
            color: white;
        }

        .btn.span-2 {
            grid-column: span 2;
        }

        .status {
            margin-top: 15px;
            padding: 10px;
            border-radius: 10px;
            text-align: center;
            font-weight: bold;
            font-size: 0.9rem;
        }

        .online {
            background: #d4edda;
            color: #155724;
        }

        .offline {
            background: #f8d7da;
            color: #721c24;
        }

        @supports (-webkit-touch-callout: none) {
            body {
                /* Allow scrolling on iOS */
                position: relative;
                width: 100%;
                min-height: 100vh;
                overflow-y: auto;
            }
            
            .calculator, .simple-calculator {
                /* Ensure calculator can scroll */
                max-height: none;
                overflow-y: visible;
            }
        }

        @media (max-width: 600px) {
            .menu-grid {
                grid-template-columns: 1fr;
            }
            
            .action-buttons {
                grid-template-columns: 1fr;
            }
            
            .calculator-title {
                font-size: 1.5rem;
            }
        }

        @media screen and (display-mode: standalone) {
            body {
                padding-top: env(safe-area-inset-top);
                padding-bottom: env(safe-area-inset-bottom);
            }
        }
    </style>
</head>
<body>
    <!-- Main Menu -->
    <div class="container" id="main-menu">
        <div class="header">
            <h1>üßÆ Multi Calculator</h1>
            <p>Seleziona il calcolatore che desideri utilizzare</p>
        </div>
        
        <div class="menu-grid">
            <div class="menu-item" onclick="showCalculator('heating')">
                <h3>üî• Heating Time Calculator</h3>
                <p>Calcola il tempo necessario per riscaldare l'acqua</p>
            </div>
            
            <div class="menu-item" onclick="showCalculator('power')">
                <h3>‚ö° Power Calculator</h3>
                <p>Calcola la potenza necessaria per il riscaldamento</p>
            </div>
            
            <div class="menu-item" onclick="showCalculator('cooling')">
                <h3>‚ùÑÔ∏è Cooling Time Calculator</h3>
                <p>Calcola il tempo di raffreddamento</p>
            </div>
            
            <div class="menu-item" onclick="showCalculator('brewing')">
                <h3>‚òï Brewing Loss Calculator</h3>
                <p>Calcola le perdite durante la preparazione</p>
            </div>
            
            <div class="menu-item" onclick="showCalculator('simple')">
                <h3>üî¢ Simple Calculator</h3>
                <p>Calcolatrice standard per operazioni base</p>
            </div>
        </div>
        
        <div id="status" class="status">
            <span id="connection-status">Controllo connessione...</span>
        </div>
    </div>

    <!-- Heating Time Calculator -->
    <div class="calculator" id="heating-calculator">
        <div class="calculator-header">
            <div class="calculator-title">üî• Heating Time Calculator</div>
            <button class="back-btn" onclick="showMenu()">‚Üê Menu</button>
        </div>
        
        <div class="input-group">
            <label for="ht_initial_temp">Initial Temperature (¬∞C)</label>
            <input type="number" id="ht_initial_temp" value="50.0" step="0.1">
        </div>
        
        <div class="input-group">
            <label for="ht_target_temp">Target Temperature (¬∞C)</label>
            <input type="number" id="ht_target_temp" value="70.0" step="0.1">
        </div>
        
        <div class="input-group">
            <label for="ht_water_volume">Water Volume (L)</label>
            <input type="number" id="ht_water_volume" value="5.0" step="0.1">
        </div>
        
        <div class="input-group">
            <label for="ht_heater_power">Heater Power (W)</label>
            <input type="number" id="ht_heater_power" value="2000.0" step="1">
        </div>
        
        <div class="input-group">
            <label for="ht_room_temp">Room Temperature (¬∞C)</label>
            <input type="number" id="ht_room_temp" value="20.0" step="0.1">
        </div>
        
        <div class="input-group">
            <label for="ht_heat_transfer_coeff">Heat Transfer Coefficient (W/m¬≤¬∑¬∞C)</label>
            <input type="number" id="ht_heat_transfer_coeff" value="15.0" step="0.1">
        </div>
        
        <div class="input-group">
            <label for="ht_surface_area">External Surface Area (m¬≤)</label>
            <input type="number" id="ht_surface_area" value="0.5" step="0.01">
        </div>
        
        <div class="input-group">
            <label for="ht_stainless_steel_volume">Stainless Steel Volume (m¬≥)</label>
            <input type="number" id="ht_stainless_steel_volume" value="0.001" step="0.0001">
        </div>
        
        <div class="action-buttons">
            <button class="action-btn reset" onclick="resetToDefault('heating')">Reset to Default</button>
            <button class="action-btn save" onclick="saveParameters('heating')">Save Parameters</button>
            <button class="action-btn load" onclick="loadParameters('heating')">Load Parameters</button>
        </div>
        
        <button class="calculate-btn" onclick="calculateHeatingTime()">Calculate Heating Time</button>
        
        <div class="results-section">
            <h3>Risultati:</h3>
            <div class="result-group">
                <label>Estimated Heating Time:</label>
                <div class="result-value" id="heating-result"></div>
            </div>
            <div class="result-group">
                <label>Time in Seconds (s):</label>
                <div class="result-value" id="heating-seconds"></div>
            </div>
        </div>
    </div>

    <!-- Power Calculator -->
    <div class="calculator" id="power-calculator">
        <div class="calculator-header">
            <div class="calculator-title">‚ö° Power Calculator</div>
            <button class="back-btn" onclick="showMenu()">‚Üê Menu</button>
        </div>
        
        <div class="input-group">
            <label for="pc_initial_temp">Initial Temperature (¬∞C)</label>
            <input type="number" id="pc_initial_temp" value="50.0" step="0.1">
        </div>
        
        <div class="input-group">
            <label for="pc_target_temp">Target Temperature (¬∞C)</label>
            <input type="number" id="pc_target_temp" value="70.0" step="0.1">
        </div>
        
        <div class="input-group">
            <label for="pc_water_volume">Water Volume (L)</label>
            <input type="number" id="pc_water_volume" value="5.0" step="0.1">
        </div>
        
        <div class="input-group">
            <label for="pc_time_required">Time Required (seconds)</label>
            <input type="number" id="pc_time_required" value="300.0" step="1">
        </div>
        
        <div class="input-group">
            <label for="pc_room_temp">Room Temperature (¬∞C)</label>
            <input type="number" id="pc_room_temp" value="20.0" step="0.1">
        </div>
        
        <div class="input-group">
            <label for="pc_heat_transfer_coeff">Heat Transfer Coefficient (W/m¬≤¬∑¬∞C)</label>
            <input type="number" id="pc_heat_transfer_coeff" value="15.0" step="0.1">
        </div>
        
        <div class="input-group">
            <label for="pc_surface_area">External Surface Area (m¬≤)</label>
            <input type="number" id="pc_surface_area" value="0.5" step="0.01">
        </div>
        
        <div class="input-group">
            <label for="pc_stainless_steel_volume">Stainless Steel Volume (m¬≥)</label>
            <input type="number" id="pc_stainless_steel_volume" value="0.001" step="0.0001">
        </div>
        
        <div class="action-buttons">
            <button class="action-btn reset" onclick="resetToDefault('power')">Reset to Default</button>
            <button class="action-btn save" onclick="saveParameters('power')">Save Parameters</button>
            <button class="action-btn load" onclick="loadParameters('power')">Load Parameters</button>
        </div>
        
        <button class="calculate-btn" onclick="calculatePower()">Calculate Required Power</button>
        
        <div class="results-section">
            <h3>Risultati:</h3>
            <div class="result-group">
                <label>Total Power Required (W/h):</label>
                <div class="result-value" id="total-power"></div>
            </div>
            <div class="result-group">
                <label>Power to Water (W/h):</label>
                <div class="result-value" id="power-to-water"></div>
            </div>
            <div class="result-group">
                <label>Power to Stainless Steel (W/h):</label>
                <div class="result-value" id="power-to-steel"></div>
            </div>
            <div class="result-group">
                <label>Power Lost to Environment (W/h):</label>
                <div class="result-value" id="power-lost"></div>
            </div>
            <div class="result-group">
                <label>Required Heater Power (W):</label>
                <div class="result-value" id="instant-power"></div>
            </div>
        </div>
    </div>

    <!-- Cooling Time Calculator -->
    <div class="calculator" id="cooling-calculator">
        <div class="calculator-header">
            <div class="calculator-title">‚ùÑÔ∏è Cooling Time Calculator</div>
            <button class="back-btn" onclick="showMenu()">‚Üê Menu</button>
        </div>
        
        <div class="input-group">
            <label for="ct_initial_temp">Initial Temperature (¬∞C)</label>
            <input type="number" id="ct_initial_temp" value="70.0" step="0.1">
        </div>
        
        <div class="input-group">
            <label for="ct_final_temp">Final Temperature (¬∞C)</label>
            <input type="number" id="ct_final_temp" value="50.0" step="0.1">
        </div>
        
        <div class="input-group">
            <label for="ct_water_volume">Water Volume (L)</label>
            <input type="number" id="ct_water_volume" value="5.0" step="0.1">
        </div>
        
        <div class="input-group">
            <label for="ct_room_temp">Room Temperature (¬∞C)</label>
            <input type="number" id="ct_room_temp" value="20.0" step="0.1">
        </div>
        
        <div class="input-group">
            <label for="ct_heat_transfer_coeff">Heat Transfer Coefficient (W/m¬≤¬∑¬∞C)</label>
            <input type="number" id="ct_heat_transfer_coeff" value="15.0" step="0.1">
        </div>
        
        <div class="input-group">
            <label for="ct_surface_area">External Surface Area (m¬≤)</label>
            <input type="number" id="ct_surface_area" value="0.5" step="0.01">
        </div>
        
        <div class="input-group">
            <label for="ct_stainless_steel_volume">Stainless Steel Volume (m¬≥)</label>
            <input type="number" id="ct_stainless_steel_volume" value="0.001" step="0.0001">
        </div>
        
        <div class="action-buttons">
            <button class="action-btn reset" onclick="resetToDefault('cooling')">Reset to Default</button>
            <button class="action-btn save" onclick="saveParameters('cooling')">Save Parameters</button>
            <button class="action-btn load" onclick="loadParameters('cooling')">Load Parameters</button>
        </div>
        
        <button class="calculate-btn" onclick="calculateCoolingTime()">Calculate Cooling Time</button>
        
        <div class="results-section">
            <h3>Risultati:</h3>
            <div class="result-group">
                <label>Estimated Cooling Time:</label>
                <div class="result-value" id="cooling-result"></div>
            </div>
            <div class="result-group">
                <label>Time in Seconds (s):</label>
                <div class="result-value" id="cooling-seconds"></div>
            </div>
            <div class="result-group">
                <label>Total Power Lost (W/h):</label>
                <div class="result-value" id="cooling-total-power-lost"></div>
            </div>
            <div class="result-group">
                <label>Total Power Lost Water (W/h):</label>
                <div class="result-value" id="cooling-total-power-lost-water"></div>
            </div>
            <div class="result-group">
                <label>Total Power Lost Stainless Steel (W/h):</label>
                <div class="result-value" id="cooling-total-power-lost-steel"></div>
            </div>
        </div>
    </div>

    <!-- Brewing Loss Calculator -->
    <div class="calculator" id="brewing-calculator">
        <div class="calculator-header">
            <div class="calculator-title">‚òï Brewing Loss Calculator</div>
            <button class="back-btn" onclick="showMenu()">‚Üê Menu</button>
        </div>
        
        <div class="input-group">
            <label for="br_initial_temp">Initial Temperature (¬∞C)</label>
            <input type="number" id="br_initial_temp" value="95.0" step="0.1">
        </div>
        
        <div class="input-group">
            <label for="br_water_volume">Water Volume (L)</label>
            <input type="number" id="br_water_volume" value="5.0" step="0.1">
        </div>
        
        <div class="input-group">
            <label for="br_stainless_steel_volume">Stainless Steel Volume (m¬≥)</label>
            <input type="number" id="br_stainless_steel_volume" value="0.001" step="0.0001">
        </div>
        
        <div class="input-group">
            <label for="br_applied_heater_power">Applied Heater Power (W)</label>
            <input type="number" id="br_applied_heater_power" value="0.0" step="1">
        </div>
        
        <div class="input-group">
            <label for="br_brewing_flow_rate">Brewing Flow Rate (ml/s)</label>
            <input type="number" id="br_brewing_flow_rate" value="5.0" step="0.1">
        </div>
        
        <div class="input-group">
            <label for="br_brewing_time_duration">Brewing Time Duration (s)</label>
            <input type="number" id="br_brewing_time_duration" value="20.0" step="0.1">
        </div>
        
        <div class="input-group">
            <label for="br_plumbing_temperature">Brewing Plumbing Temperature (¬∞C)</label>
            <input type="number" id="br_plumbing_temperature" value="20.0" step="0.1">
        </div>
        
        <div class="action-buttons">
            <button class="action-btn reset" onclick="resetToDefault('brewing')">Reset to Default</button>
            <button class="action-btn save" onclick="saveParameters('brewing')">Save Parameters</button>
            <button class="action-btn load" onclick="loadParameters('brewing')">Load Parameters</button>
        </div>
        
        <button class="calculate-btn" onclick="calculateBrewingLoss()">Calculate Brewing Loss</button>
        
        <div class="results-section">
            <h3>Risultati:</h3>
            <div class="result-group">
                <label>Boiler Final Temperature (¬∞C):</label>
                <div class="result-value" id="final-temp"></div>
            </div>
            <div class="result-group">
                <label>Boiler Temperature Loss (¬∞C):</label>
                <div class="result-value" id="lost-temp"></div>
            </div>
            <div class="result-group">
                <label>Average Brewed Temperature (¬∞C):</label>
                <div class="result-value" id="average-brewed-temp"></div>
            </div>
            <div class="result-group">
                <label>Initial Brewed Temperature (¬∞C):</label>
                <div class="result-value" id="initial-brewed-temp"></div>
            </div>
            <div class="result-group">
                <label>Final Brewed Temperature (¬∞C):</label>
                <div class="result-value" id="final-brewed-temp"></div>
            </div>
            <div class="result-group">
                <label>Total Brewed Volume (L):</label>
                <div class="result-value" id="total-brewed-volume"></div>
            </div>
            <div class="result-group">
                <label>Brewing Energy Loss (W):</label>
                <div class="result-value" id="brewing-energy-loss"></div>
            </div>
        </div>
    </div>

    <!-- Simple Calculator -->
    <div class="simple-calculator" id="simple-calculator">
        <div class="calculator-header">
            <div class="calculator-title">üî¢ Simple Calculator</div>
            <button class="back-btn" onclick="showMenu()">‚Üê Menu</button>
        </div>
        
        <div class="display">
            <div class="previous-operand" id="previous-operand"></div>
            <div class="current-operand" id="current-operand">0</div>
        </div>
        
        <div class="buttons">
            <button class="btn clear" onclick="clearAll()">AC</button>
            <button class="btn delete" onclick="deleteLast()">DEL</button>
            <button class="btn operator" onclick="chooseOperation('%')">%</button>
            <button class="btn operator" onclick="chooseOperation('√∑')">√∑</button>
            
            <button class="btn" onclick="appendNumber('7')">7</button>
            <button class="btn" onclick="appendNumber('8')">8</button>
            <button class="btn" onclick="appendNumber('9')">9</button>
            <button class="btn operator" onclick="chooseOperation('√ó')">√ó</button>
            
            <button class="btn" onclick="appendNumber('4')">4</button>
            <button class="btn" onclick="appendNumber('5')">5</button>
            <button class="btn" onclick="appendNumber('6')">6</button>
            <button class="btn operator" onclick="chooseOperation('-')">-</button>
            
            <button class="btn" onclick="appendNumber('1')">1</button>
            <button class="btn" onclick="appendNumber('2')">2</button>
            <button class="btn" onclick="appendNumber('3')">3</button>
            <button class="btn operator" onclick="chooseOperation('+')">+</button>
            
            <button class="btn" onclick="appendNumber('0')">0</button>
            <button class="btn" onclick="appendDecimal()">.</button>
            <button class="btn equals span-2" onclick="compute()">=</button>
        </div>
    </div>

    <script>
        // Default values from calculator_config.ini
        const defaultValues = {
            // Heating Time Calculator
            ht_initial_temp: 50.0,
            ht_target_temp: 70.0,
            ht_water_volume: 5.0,
            ht_heater_power: 2000.0,
            ht_room_temp: 20.0,
            ht_heat_transfer_coeff: 15.0,
            ht_surface_area: 0.5,
            ht_stainless_steel_volume: 0.001,
            
            // Power Calculator
            pc_initial_temp: 50.0,
            pc_target_temp: 70.0,
            pc_water_volume: 5.0,
            pc_stainless_steel_volume: 0.001,
            pc_time_required: 300.0,
            pc_room_temp: 20.0,
            pc_heat_transfer_coeff: 15.0,
            pc_surface_area: 0.5,
            
            // Cooling Time Calculator
            ct_initial_temp: 70.0,
            ct_final_temp: 50.0,
            ct_water_volume: 5.0,
            ct_room_temp: 20.0,
            ct_heat_transfer_coeff: 15.0,
            ct_surface_area: 0.5,
            ct_stainless_steel_volume: 0.001,
            
            // Brewing Loss Calculator
            br_initial_temp: 95.0,
            br_water_volume: 5.0,
            br_stainless_steel_volume: 0.001,
            br_applied_heater_power: 0.0,
            br_brewing_flow_rate: 5.0,
            br_brewing_time_duration: 20.0,
            br_plumbing_temperature: 20.0
        };

        // Navigation functions
        function showMenu() {
            document.getElementById('main-menu').style.display = 'block';
            document.querySelectorAll('.calculator, .simple-calculator').forEach(calc => {
                calc.classList.remove('active');
            });
        }

        function showCalculator(type) {
            document.getElementById('main-menu').style.display = 'none';
            document.querySelectorAll('.calculator, .simple-calculator').forEach(calc => {
                calc.classList.remove('active');
            });
            
            if (type === 'simple') {
                document.getElementById('simple-calculator').classList.add('active');
            } else {
                document.getElementById(type + '-calculator').classList.add('active');
            }
        }

        // Parameter management functions
        function resetToDefault(calculatorType) {
            const prefix = calculatorType === 'heating' ? 'ht_' : 
                          calculatorType === 'power' ? 'pc_' : 
                          calculatorType === 'cooling' ? 'ct_' : 'br_';
            
            Object.keys(defaultValues).forEach(key => {
                if (key.startsWith(prefix)) {
                    const input = document.getElementById(key);
                    if (input) {
                        input.value = defaultValues[key];
                    }
                }
            });
            
            showNotification('Parameters reset to default values');
        }

        function saveParameters(calculatorType) {
            const prefix = calculatorType === 'heating' ? 'ht_' : 
                          calculatorType === 'power' ? 'pc_' : 
                          calculatorType === 'cooling' ? 'ct_' : 'br_';
            
            const params = {};
            Object.keys(defaultValues).forEach(key => {
                if (key.startsWith(prefix)) {
                    const input = document.getElementById(key);
                    if (input) {
                        params[key] = parseFloat(input.value) || 0;
                    }
                }
            });
            
            localStorage.setItem('savedParams_' + calculatorType, JSON.stringify(params));
            showNotification('Parameters saved successfully');
        }

        function loadParameters(calculatorType) {
            const savedParams = localStorage.getItem('savedParams_' + calculatorType);
            if (savedParams) {
                const params = JSON.parse(savedParams);
                Object.keys(params).forEach(key => {
                    const input = document.getElementById(key);
                    if (input) {
                        input.value = params[key];
                    }
                });
                showNotification('Parameters loaded successfully');
            } else {
                showNotification('No saved parameters found');
            }
        }

        function showNotification(message) {
            // Create a simple notification
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: #27ae60;
                color: white;
                padding: 15px 20px;
                border-radius: 10px;
                z-index: 1000;
                font-weight: bold;
            `;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // Calculation functions with correct algorithms from boiler_calculator.py
        function calculateHeatingTime() {
            try {
                const params = getCalculatorParams('ht_');
                
                // Constants from Python code
                const WATER_SPECIFIC_HEAT = 4186;  // J/(kg¬∑¬∞C)
                const WATER_DENSITY = 1.0;  // kg/L
                const STAINLESS_STEEL_DENSITY = 8000;  // kg/m¬≥
                const STAINLESS_STEEL_SPECIFIC_HEAT = 500;  // J/(kg¬∑¬∞C)
                
                // Calculate masses
                const water_mass = params.ht_water_volume * WATER_DENSITY;  // kg
                const stainless_steel_mass = params.ht_stainless_steel_volume * STAINLESS_STEEL_DENSITY;  // kg
                
                // Calculate time using numerical approximation (same as Python)
                const time_step = 0.1;  // seconds
                let current_temp = params.ht_initial_temp;
                let total_time = 0;
                
                while (current_temp < params.ht_target_temp && total_time < 3600) {  // limit to 1 hour
                    // Calculate heat loss using heat transfer coefficient and surface area
                    const heat_loss = params.ht_heat_transfer_coeff * params.ht_surface_area * (current_temp - params.ht_room_temp);
                    
                    // Calculate energy input from heater for this time step
                    const energy_input = params.ht_heater_power * time_step;  // Joules
                    
                    // Calculate energy lost to environment in this time step
                    const energy_lost = heat_loss * time_step;  // Joules
                    
                    // Calculate temperature change from net energy
                    const delta_temp = (energy_input - energy_lost) / (water_mass * WATER_SPECIFIC_HEAT + stainless_steel_mass * STAINLESS_STEEL_SPECIFIC_HEAT);
                    current_temp += delta_temp;
                    total_time += time_step;
                }
                
                // Format results (same as Python)
                let formatted_result, seconds_result;
                if (total_time >= 3600) {
                    formatted_result = "Over 1 hour";
                    seconds_result = "> 3600";
                } else {
                    const minutes = Math.floor(total_time / 60);
                    const seconds = Math.floor(total_time % 60);
                    formatted_result = `${minutes}m ${seconds}s`;
                    seconds_result = total_time.toFixed(1);
                }
                
                // Update result fields
                document.getElementById('heating-result').textContent = formatted_result;
                document.getElementById('heating-seconds').textContent = seconds_result;
                
            } catch (error) {
                alert('Errore nel calcolo: ' + error.message);
            }
        }

        function calculatePower() {
            try {
                const params = getCalculatorParams('pc_');
                
                // Constants from Python code
                const WATER_SPECIFIC_HEAT = 4186;  // J/(kg¬∑¬∞C)
                const WATER_DENSITY = 1.0;  // kg/L
                const STAINLESS_STEEL_DENSITY = 8000;  // kg/m¬≥
                const STAINLESS_STEEL_SPECIFIC_HEAT = 500;  // J/(kg¬∑¬∞C)
                
                // Calculate masses
                const water_mass = params.pc_water_volume * WATER_DENSITY;  // kg
                const stainless_steel_mass = params.pc_stainless_steel_volume * STAINLESS_STEEL_DENSITY;  // kg
                
                // Use numerical approximation to calculate power requirements (same as Python)
                const time_step = 0.1;  // seconds
                
                const total_energy_to_water = (water_mass * WATER_SPECIFIC_HEAT) * (params.pc_target_temp - params.pc_initial_temp);
                const total_energy_to_steel = (stainless_steel_mass * STAINLESS_STEEL_SPECIFIC_HEAT) * (params.pc_target_temp - params.pc_initial_temp);
                const first_estimate_total_energy_lost = params.pc_time_required * params.pc_heat_transfer_coeff * params.pc_surface_area * ((params.pc_target_temp + params.pc_initial_temp)/2 - params.pc_room_temp);
                const first_estimate_total_energy = total_energy_to_water + total_energy_to_steel + first_estimate_total_energy_lost;
                let first_estimate_total_power = first_estimate_total_energy / params.pc_time_required;
                
                // Iterative calculation (same as Python)
                let number_of_iterations = 0;
                while (number_of_iterations < 10) {
                    let current_temp = params.pc_initial_temp;
                    let total_energy_lost = 0;
                    let simulation_time = 0;
                    
                    while (simulation_time < params.pc_time_required && current_temp < params.pc_target_temp) {
                        // Calculate heat loss at current temperature
                        const heat_loss = params.pc_heat_transfer_coeff * params.pc_surface_area * (current_temp - params.pc_room_temp);
                        total_energy_lost += heat_loss * time_step;
                        
                        // Calculate temperature change from net energy
                        const delta_temp = (first_estimate_total_power * time_step - heat_loss * time_step) / (water_mass * WATER_SPECIFIC_HEAT + stainless_steel_mass * STAINLESS_STEEL_SPECIFIC_HEAT);
                        current_temp += delta_temp;
                        
                        // Update simulation time
                        simulation_time += time_step;
                    }
                    first_estimate_total_power = (total_energy_to_water + total_energy_to_steel + total_energy_lost) / params.pc_time_required;
                    number_of_iterations++;
                }
                
                // Calculate average powers (same as Python)
                const power_to_water = total_energy_to_water / params.pc_time_required;  // Watts
                const power_to_steel = total_energy_to_steel / params.pc_time_required;  // Watts
                const power_lost = total_energy_lost / params.pc_time_required;  // Watts
                const total_power = power_to_water + power_to_steel + power_lost;  // Watts
                
                // Convert to W/h for display (same as Python)
                const hours = params.pc_time_required / 3600;  // convert seconds to hours
                const total_power_per_hour = total_power * hours;
                const power_to_water_per_hour = power_to_water * hours;
                const power_to_steel_per_hour = power_to_steel * hours;
                const power_lost_per_hour = power_lost * hours;
                
                // Update result fields
                document.getElementById('total-power').textContent = total_power_per_hour.toFixed(1);
                document.getElementById('power-to-water').textContent = power_to_water_per_hour.toFixed(1);
                document.getElementById('power-to-steel').textContent = power_to_steel_per_hour.toFixed(1);
                document.getElementById('power-lost').textContent = power_lost_per_hour.toFixed(1);
                document.getElementById('instant-power').textContent = total_power.toFixed(1);
                
            } catch (error) {
                alert('Errore nel calcolo: ' + error.message);
            }
        }

        function calculateCoolingTime() {
            try {
                const params = getCalculatorParams('ct_');
                
                // Constants from Python code
                const WATER_SPECIFIC_HEAT = 4186;  // J/(kg¬∑¬∞C)
                const WATER_DENSITY = 1.0;  // kg/L
                const STAINLESS_STEEL_DENSITY = 8000;  // kg/m¬≥
                const STAINLESS_STEEL_SPECIFIC_HEAT = 500;  // J/(kg¬∑¬∞C)
                
                // Calculate masses
                const water_mass = params.ct_water_volume * WATER_DENSITY;  // kg
                const stainless_steel_mass = params.ct_stainless_steel_volume * STAINLESS_STEEL_DENSITY;  // kg
                
                // Calculate time using numerical approximation (same as Python)
                const time_step = 0.1;  // seconds
                let current_temp = params.ct_initial_temp;
                let total_time = 0;
                let total_energy_lost = 0;  // Track total energy lost
                let total_energy_lost_water = 0;  // Track energy lost from water
                let total_energy_lost_steel = 0;  // Track energy lost from stainless steel
                
                while (current_temp > params.ct_final_temp && total_time < 10800) {  // limit to 3 hours
                    // Calculate heat loss using heat transfer coefficient and surface area
                    const heat_loss = params.ct_heat_transfer_coeff * params.ct_surface_area * (current_temp - params.ct_room_temp);
                    
                    // Calculate energy lost to environment in this time step
                    const energy_lost = heat_loss * time_step;  // Joules
                    total_energy_lost += energy_lost;  // Accumulate total energy lost
                    
                    // Calculate temperature change from energy lost
                    const delta_temp = energy_lost / (water_mass * WATER_SPECIFIC_HEAT + stainless_steel_mass * STAINLESS_STEEL_SPECIFIC_HEAT);
                    current_temp -= delta_temp;  // Decrease current temperature
                    total_time += time_step;
                }
                
                // Calculate Total Power Lost (W/H) (same as Python)
                const delta_temp = params.ct_initial_temp - current_temp;
                const total_power_lost_water = delta_temp * (water_mass * WATER_SPECIFIC_HEAT) / 3600;
                const total_power_lost_steel = delta_temp * (stainless_steel_mass * STAINLESS_STEEL_SPECIFIC_HEAT) / 3600;
                const total_power_lost = total_power_lost_water + total_power_lost_steel;
                
                // Format results (same as Python)
                let formatted_result, seconds_result;
                if (total_time >= 10800) {
                    formatted_result = "Over 3 hours";
                    seconds_result = "> 10800";
                } else {
                    const minutes = Math.floor(total_time / 60);
                    const seconds = Math.floor(total_time % 60);
                    formatted_result = `${minutes}m ${seconds}s`;
                    seconds_result = total_time.toFixed(1);
                }
                
                // Update result fields
                document.getElementById('cooling-result').textContent = formatted_result;
                document.getElementById('cooling-seconds').textContent = seconds_result;
                document.getElementById('cooling-total-power-lost').textContent = total_power_lost.toFixed(1);
                document.getElementById('cooling-total-power-lost-water').textContent = total_power_lost_water.toFixed(1);
                document.getElementById('cooling-total-power-lost-steel').textContent = total_power_lost_steel.toFixed(1);
                
            } catch (error) {
                alert('Errore nel calcolo: ' + error.message);
            }
        }

        function calculateBrewingLoss() {
            try {
                const params = getCalculatorParams('br_');
                
                // Constants from Python code
                const WATER_SPECIFIC_HEAT = 4186;  // J/(kg¬∑¬∞C)
                const STEEL_SPECIFIC_HEAT = 500;   // J/(kg¬∑¬∞C)
                const WATER_DENSITY = 1.0;         // kg/L
                const STEEL_DENSITY = 8000.0;      // kg/m¬≥
                
                // Calculate masses (same as Python)
                const water_mass = params.br_water_volume * WATER_DENSITY;
                const steel_mass = params.br_stainless_steel_volume * STEEL_DENSITY;
                const total_thermal_mass = (water_mass * WATER_SPECIFIC_HEAT + steel_mass * STEEL_SPECIFIC_HEAT);
                
                // Calculate water replacement rate (kg/s) (same as Python)
                const water_flow_mass = params.br_brewing_flow_rate * WATER_DENSITY / 1000.0;  // (mL/s *Kg/L) / 1000 to get kg/s
                
                // Calculate time using numerical approximation (same as Python)
                const time_step = 0.01;  // seconds
                let current_temp = params.br_initial_temp;
                let total_time = 0;  // Track total energy lost
                let brewing_heat_loss = 0;
                let total_brewing_energy_loss = 0;
                let average_brewed_temp = 0;
                const numberofsteps = Math.floor(params.br_brewing_time_duration / time_step);
                let initial_brewed_temp = 0;
                
                while (total_time < params.br_brewing_time_duration) {
                    brewing_heat_loss = (water_flow_mass * WATER_SPECIFIC_HEAT * (current_temp - params.br_plumbing_temperature));
                    const brewing_energy_loss_step = brewing_heat_loss * time_step;
                    total_brewing_energy_loss += brewing_energy_loss_step;
                    
                    const applied_heater_energy_step = params.br_applied_heater_power * time_step;
                    
                    const delta_energy_step = applied_heater_energy_step - brewing_energy_loss_step;
                    // Calculate temperature change from energy lost and applied heater power
                    const delta_temp_step = (delta_energy_step) / (total_thermal_mass);
                    current_temp += delta_temp_step;  // update current temperature
                    
                    if (total_time === 0) {
                        initial_brewed_temp = current_temp;
                    }
                    total_time += time_step;
                    average_brewed_temp += current_temp / numberofsteps;
                }
                
                const brewing_energy_loss = (total_brewing_energy_loss / params.br_brewing_time_duration);
                
                const final_temp = current_temp;
                const lost_temp = params.br_initial_temp - final_temp;
                const final_brewed_temp = final_temp;
                
                const total_brewed_volume = (params.br_brewing_flow_rate * params.br_brewing_time_duration) / 1000.0;  // Convert mL to L
                
                // Update result fields
                document.getElementById('final-temp').textContent = final_temp.toFixed(1);
                document.getElementById('lost-temp').textContent = lost_temp.toFixed(1);
                document.getElementById('average-brewed-temp').textContent = average_brewed_temp.toFixed(1);
                document.getElementById('initial-brewed-temp').textContent = initial_brewed_temp.toFixed(1);
                document.getElementById('final-brewed-temp').textContent = final_brewed_temp.toFixed(1);
                document.getElementById('total-brewed-volume').textContent = total_brewed_volume.toFixed(1);
                document.getElementById('brewing-energy-loss').textContent = brewing_energy_loss.toFixed(1);
                
            } catch (error) {
                alert('Errore nel calcolo: ' + error.message);
            }
        }

        function getCalculatorParams(prefix) {
            const params = {};
            Object.keys(defaultValues).forEach(key => {
                if (key.startsWith(prefix)) {
                    const input = document.getElementById(key);
                    if (input) {
                        params[key] = parseFloat(input.value) || 0;
                    }
                }
            });
            return params;
        }



        // Simple Calculator (from previous implementation)
        class Calculator {
            constructor() {
                this.previousOperand = '';
                this.currentOperand = '0';
                this.operation = undefined;
            }

            clear() {
                this.currentOperand = '0';
                this.previousOperand = '';
                this.operation = undefined;
            }

            delete() {
                if (this.currentOperand === '0') return;
                this.currentOperand = this.currentOperand.toString().slice(0, -1);
                if (this.currentOperand === '') this.currentOperand = '0';
            }

            appendNumber(number) {
                if (number === '.' && this.currentOperand.includes('.')) return;
                if (this.currentOperand === '0' && number !== '.') {
                    this.currentOperand = number.toString();
                } else {
                    this.currentOperand = this.currentOperand.toString() + number.toString();
                }
            }

            chooseOperation(operation) {
                if (this.currentOperand === '0') return;
                if (this.previousOperand !== '') {
                    this.compute();
                }
                this.operation = operation;
                this.previousOperand = this.currentOperand;
                this.currentOperand = '0';
            }

            compute() {
                let computation;
                const prev = parseFloat(this.previousOperand);
                const current = parseFloat(this.currentOperand);
                if (isNaN(prev) || isNaN(current)) return;

                switch (this.operation) {
                    case '+':
                        computation = prev + current;
                        break;
                    case '-':
                        computation = prev - current;
                        break;
                    case '√ó':
                        computation = prev * current;
                        break;
                    case '√∑':
                        if (current === 0) {
                            alert('Non puoi dividere per zero!');
                            return;
                        }
                        computation = prev / current;
                        break;
                    case '%':
                        computation = prev % current;
                        break;
                    default:
                        return;
                }

                this.currentOperand = computation;
                this.operation = undefined;
                this.previousOperand = '';
            }

            getDisplayNumber(number) {
                const stringNumber = number.toString();
                const integerDigits = parseFloat(stringNumber.split('.')[0]);
                const decimalDigits = stringNumber.split('.')[1];
                let integerDisplay;
                
                if (isNaN(integerDigits)) {
                    integerDisplay = '';
                } else {
                    integerDisplay = integerDigits.toLocaleString('it-IT', {
                        maximumFractionDigits: 0
                    });
                }
                
                if (decimalDigits != null) {
                    return `${integerDisplay}.${decimalDigits}`;
                } else {
                    return integerDisplay;
                }
            }

            updateDisplay() {
                document.getElementById('current-operand').innerText = this.getDisplayNumber(this.currentOperand);
                if (this.operation != null) {
                    document.getElementById('previous-operand').innerText = 
                        `${this.getDisplayNumber(this.previousOperand)} ${this.operation}`;
                } else {
                    document.getElementById('previous-operand').innerText = '';
                }
            }
        }

        const calculator = new Calculator();

        // Simple calculator functions
        function clearAll() {
            calculator.clear();
            calculator.updateDisplay();
        }

        function deleteLast() {
            calculator.delete();
            calculator.updateDisplay();
        }

        function appendNumber(number) {
            calculator.appendNumber(number);
            calculator.updateDisplay();
        }

        function appendDecimal() {
            calculator.appendNumber('.');
            calculator.updateDisplay();
        }

        function chooseOperation(operation) {
            calculator.chooseOperation(operation);
            calculator.updateDisplay();
        }

        function compute() {
            calculator.compute();
            calculator.updateDisplay();
        }

        // Keyboard support
        document.addEventListener('keydown', (event) => {
            const key = event.key;
            
            if (key >= '0' && key <= '9') {
                appendNumber(key);
            } else if (key === '.') {
                appendDecimal();
            } else if (key === '+') {
                chooseOperation('+');
            } else if (key === '-') {
                chooseOperation('-');
            } else if (key === '*') {
                chooseOperation('√ó');
            } else if (key === '/') {
                event.preventDefault();
                chooseOperation('√∑');
            } else if (key === '%') {
                chooseOperation('%');
            } else if (key === 'Enter' || key === '=') {
                compute();
            } else if (key === 'Backspace') {
                deleteLast();
            } else if (key === 'Escape') {
                clearAll();
            }
        });

        // PWA functionality
        function updateConnectionStatus() {
            const statusElement = document.getElementById('connection-status');
            const statusDiv = document.getElementById('status');
            
            if (navigator.onLine) {
                statusElement.textContent = 'üü¢ Online';
                statusDiv.className = 'status online';
            } else {
                statusElement.textContent = 'üî¥ Offline';
                statusDiv.className = 'status offline';
            }
        }

        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
        });

        window.addEventListener('online', updateConnectionStatus);
        window.addEventListener('offline', updateConnectionStatus);
        
        updateConnectionStatus();

        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js')
                .then((registration) => {
                    console.log('SW registered: ', registration);
                })
                .catch((registrationError) => {
                    console.log('SW registration failed: ', registrationError);
                });
        }

        // iOS specific optimizations
        if (navigator.userAgent.includes('iPhone') || navigator.userAgent.includes('iPad')) {
            let lastTouchEnd = 0;
            document.addEventListener('touchend', function (event) {
                const now = (new Date()).getTime();
                if (now - lastTouchEnd <= 300) {
                    event.preventDefault();
                }
                lastTouchEnd = now;
            }, false);

            if (window.navigator.standalone) {
                document.body.classList.add('standalone');
            }
        }

        document.body.addEventListener('touchmove', function(e) {
            if (e.target.closest('.calculator, .simple-calculator')) {
                e.preventDefault();
            }
        }, { passive: false });
    </script>
</body>
</html> 